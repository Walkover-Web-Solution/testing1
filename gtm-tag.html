<script>
// GTM Bridge Caller - Clean & Minimal
(function() {
  var BRIDGE_URL = "https://lingering-heart-256b.shubhendra-e5e.workers.dev";
  
  var xhr = new XMLHttpRequest();
  xhr.open("POST", BRIDGE_URL, true);
  xhr.setRequestHeader("Content-Type", "application/json");
  xhr.withCredentials = true;
  
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 300) {
      try {
        var data = JSON.parse(xhr.responseText);
        
        // Push to dataLayer
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
          'event': 'first_domain_tracked',
          'first_domain': data.first_domain,
          'is_first_visit': data.set_now
        });
        
      } catch (e) {
        console.warn("Bridge parse error");
      }
    }
  };
  
  // Worker detects domain from Origin header automatically
  xhr.send('{}');
})();
</script>
